{"ast":null,"code":"import _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nvar _jsxFileName = \"C:\\\\Users\\\\Bus209\\\\Documents\\\\htdocs\\\\chatReactNative\\\\App.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nimport { StatusBar } from 'expo-status-bar';\nimport React from 'react';\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport AsyncStorage from '@react-native-community/async-storage';\nimport io from 'socket.io-client';\nimport { GiftedChat } from 'react-native-gifted-chat';\nvar USER_ID = '@userId';\n\nvar Main = function (_React$Component) {\n  _inherits(Main, _React$Component);\n\n  var _super = _createSuper(Main);\n\n  function Main(props) {\n    var _this;\n\n    _classCallCheck(this, Main);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      messages: [],\n      userId: null\n    };\n    _this.determineUser = _this.determineUser.bind(_assertThisInitialized(_this));\n    _this.onReceivedMessage = _this.onReceivedMessage.bind(_assertThisInitialized(_this));\n    _this.onSend = _this.onSend.bind(_assertThisInitialized(_this));\n    _this._storeMessages = _this._storeMessages.bind(_assertThisInitialized(_this));\n    _this.socket = io('http://localhost:3000');\n\n    _this.socket.on('message', _this.onReceivedMessage);\n\n    _this.determineUser();\n\n    return _this;\n  }\n\n  _createClass(Main, [{\n    key: \"determineUser\",\n    value: function determineUser() {\n      var _this2 = this;\n\n      AsyncStorage.getItem(USER_ID).then(function (userId) {\n        if (!userId) {\n          _this2.socket.emit('userJoined', null);\n\n          _this2.socket.on('userJoined', function (userId) {\n            AsyncStorage.setItem(USER_ID, userId);\n\n            _this2.setState(userId);\n          });\n        } else {\n          _this2.socket.emit('userJoined', userId);\n\n          _this2.setState({\n            userId: userId\n          });\n        }\n      }).catch(function (e) {\n        return alert(e);\n      });\n    }\n  }, {\n    key: \"onReceivedMessage\",\n    value: function onReceivedMessage(messages) {\n      console.log('messages 2: ' + JSON.stringify(messages));\n\n      this._storeMessages(messages);\n    }\n  }, {\n    key: \"onSend\",\n    value: function onSend() {\n      var messages = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n      console.log('messages: ' + JSON.stringify(messages));\n      this.socket.emit('message', messages[0]);\n    }\n  }, {\n    key: \"_storeMessages\",\n    value: function _storeMessages(messages) {\n      this.setState(function (previousState) {\n        return {\n          messages: GiftedChat.append(previousState.messages, messages)\n        };\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var user = {\n        _id: this.state.userId || -1\n      };\n      return React.createElement(GiftedChat, {\n        messages: this.state.messages,\n        onSend: this.onSend,\n        user: user,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 69,\n          columnNumber: 5\n        }\n      });\n    }\n  }]);\n\n  return Main;\n}(React.Component);\n\nexport { Main as default };\nvar styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: '#fff',\n    alignItems: 'center',\n    justifyContent: 'center'\n  }\n});","map":{"version":3,"sources":["C:/Users/Bus209/Documents/htdocs/chatReactNative/App.js"],"names":["StatusBar","React","AsyncStorage","io","GiftedChat","USER_ID","Main","props","state","messages","userId","determineUser","bind","onReceivedMessage","onSend","_storeMessages","socket","on","getItem","then","emit","setItem","setState","catch","e","alert","console","log","JSON","stringify","previousState","append","user","_id","Component","styles","StyleSheet","create","container","flex","backgroundColor","alignItems","justifyContent"],"mappings":"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","sourcesContent":["import { StatusBar } from 'expo-status-bar';\r\nimport React from 'react';\r\nimport { StyleSheet, Text, View } from 'react-native';\r\nimport AsyncStorage from '@react-native-community/async-storage';\r\n\r\n//import SocketIOClient from  'sockect.io-client'\r\nimport io from 'socket.io-client';\r\n\r\nimport { GiftedChat } from 'react-native-gifted-chat'\r\n\r\nconst USER_ID = '@userId'\r\n\r\nexport default class Main extends React.Component{\r\n  constructor(props){\r\n    super(props);\r\n    this.state = {\r\n      messages:[],\r\n      userId: null\r\n    }\r\n    this.determineUser = this.determineUser.bind(this)\r\n    this.onReceivedMessage = this.onReceivedMessage.bind(this);\r\n    this.onSend = this.onSend.bind(this);\r\n    this._storeMessages = this._storeMessages.bind(this)\r\n\r\n    //this.sockect = SocketIOClient('http://localhost:3000');\r\n    this.socket = io('http://localhost:3000');\r\n    /* this.socket.on('connect', function(){\r\n      console.log('cliente conectado.')\r\n    }); */\r\n    this.socket.on('message', this.onReceivedMessage)\r\n    this.determineUser();\r\n  }\r\n  determineUser(){\r\n    AsyncStorage.getItem(USER_ID).then((userId)=>{\r\n      if(!userId){\r\n          this.socket.emit('userJoined', null);\r\n          this.socket.on('userJoined', (userId)=>{\r\n          AsyncStorage.setItem(USER_ID, userId);\r\n              this.setState(userId);\r\n          })\r\n      }else{\r\n        this.socket.emit('userJoined', userId)\r\n        this.setState({userId});\r\n      }\r\n    }).catch((e) => alert(e))\r\n  }\r\n  onReceivedMessage(messages){\r\n    console.log('messages 2: '+JSON.stringify(messages))  \r\n    this._storeMessages(messages);\r\n  }\r\n  onSend(messages=[]){\r\n    console.log('messages: '+JSON.stringify(messages))\r\n    this.socket.emit('message',messages[0])\r\n  }\r\n  _storeMessages(messages){\r\n    //console.log('messages 3: '+JSON.stringify(messages))\r\n    this.setState((previousState)=>{\r\n      //console.log('previousState: '+JSON.stringify(previousState))\r\n      \r\n      return{\r\n        messages: GiftedChat.append(previousState.messages, messages)\r\n      }\r\n    })\r\n  }\r\n  render(){\r\n    var user = { _id: this.state.userId || -1}\r\n    return(\r\n    \r\n    <GiftedChat\r\n       messages={this.state.messages}\r\n       onSend={this.onSend}\r\n       user={user}\r\n       />\r\n    )\r\n    \r\n  }\r\n  \r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    flex: 1,\r\n    backgroundColor: '#fff',\r\n    alignItems: 'center',\r\n    justifyContent: 'center',\r\n  },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}